<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweet Strategy: Haribo Business English Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #45B7D1 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .header::before {
            content: 'üç¨';
            position: absolute;
            top: 20px;
            left: 30px;
            font-size: 3em;
            animation: bounce 2s infinite;
        }
        .header::after {
            content: 'üè≠';
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 3em;
            animation: bounce 2s infinite 1s;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .game-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 15px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .progress-bar {
            width: 100%;
            height: 15px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFD700);
            border-radius: 10px;
            width: 0%;
            transition: width 0.8s ease;
            position: relative;
        }
        .progress::after {
            content: 'üéØ';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-60%) scale(1.2); }
        }
        .lesson-content {
            padding: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .warmup { background: linear-gradient(135deg, #FFE0B2, #FFAB40); }
        .listening { background: linear-gradient(135deg, #E8F5E8, #66BB6A); }
        .vocab { background: linear-gradient(135deg, #F3E5F5, #AB47BC); }
        .gapfill { background: linear-gradient(135deg, #FFF3E0, #FFA726); }
        .quiz { background: linear-gradient(135deg, #FFEBEE, #EF5350); }
        .challenge { background: linear-gradient(135deg, #FFF8E1, #FFCA28); }
        .comprehension { background: linear-gradient(135deg, #E3F2FD, #42A5F5); }
        .analysis { background: linear-gradient(135deg, #F1F8E9, #8BC34A); }
        .grammar { background: linear-gradient(135deg, #FFD1E3, #F48FB1); }
        .new-vocab { background: linear-gradient(135deg, #C5CAE9, #7986CB); }
        .reported-speech { background: linear-gradient(135deg, #E0F7FA, #4DD0E1); }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .level-badge {
            background: #FF6B6B;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.7em;
            position: absolute;
            right: 0;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }
        .story-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #66BB6A;
            font-size: 1.1em;
            line-height: 1.8;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .quiz-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .question-counter {
            background: #EF5350;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        .quiz-question {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            font-weight: 500;
        }
        .quiz-options {
            display: grid;
            gap: 12px;
        }
        .quiz-option {
            background: #f8f9fa;
            border: 2px solid #ddd;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }
        .quiz-option:hover {
            background: #e3f2fd;
            border-color: #42A5F5;
            transform: translateX(5px);
        }
        .quiz-option.correct {
            background: #66BB6A !important;
            color: white !important;
            border-color: #4CAF50 !important;
        }
        .quiz-option.incorrect {
            background: #EF5350 !important;
            color: white !important;
            border-color: #f44336 !important;
        }
        .number-input {
            display: inline-block;
            width: 100px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 0 5px;
            text-align: center;
            font-weight: bold;
            transition: border-color 0.3s ease;
            font-size: 1.1em;
        }
        .number-input:focus {
            outline: none;
            border-color: #42A5F5;
        }
        .number-input.correct {
            border-color: #66BB6A;
            background: #E8F5E8;
        }
        .number-input.incorrect {
            border-color: #EF5350;
            background: #FFEBEE;
        }
        .true-false-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        .tf-button {
            background: white;
            border: 3px solid #ddd;
            padding: 20px 40px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        .tf-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .tf-button.true {
            color: #66BB6A;
            border-color: #66BB6A;
        }
        .tf-button.false {
            color: #EF5350;
            border-color: #EF5350;
        }
        .tf-button.selected.true {
            background: #66BB6A;
            color: white;
        }
        .tf-button.selected.false {
            background: #EF5350;
            color: white;
        }
        .btn {
            background: linear-gradient(135deg, #66BB6A, #4CAF50);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 15px 10px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 187, 106, 0.3);
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 187, 106, 0.4);
        }
        .achievement {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            animation: achievementPop 0.6s ease;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
        }
        @keyframes achievementPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .highlight {
            background: linear-gradient(120deg, #FFEB3B 0%, #FFE082 100%);
            padding: 3px 6px;
            border-radius: 5px;
            font-weight: 500;
        }
        .feedback-box {
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            font-size: 1.1em;
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .feedback-box.excellent {
            background: linear-gradient(135deg, #E8F5E8, #C8E6C9);
            border-left: 5px solid #66BB6A;
            color: #2E7D32;
        }
        .feedback-box.needs-improvement {
            background: linear-gradient(135deg, #FFEBEE, #FFCDD2);
            border-left: 5px solid #EF5350;
            color: #C62828;
        }
        .timer {
            background: #FF5722;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            animation: timerPulse 1s infinite;
            margin: 10px 0;
        }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Gap Fill Styles */
        .gap-fill-text {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #FFA726;
            font-size: 1.1em;
            line-height: 1.8;
        }
        .gap-input {
            display: inline-block;
            width: 120px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 0 5px;
            text-align: center;
            font-weight: bold;
            transition: border-color 0.3s ease;
            background: #FFF8E1;
            cursor: pointer;
        }
        .gap-input:focus {
            outline: none;
            border-color: #FFA726;
        }
        .gap-input.correct {
            border-color: #66BB6A;
            background: #E8F5E8;
        }
        .gap-input.incorrect {
            border-color: #EF5350;
            background: #FFEBEE;
        }
        .word-bank {
            background: #FFF8E1;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px dashed #FFA726;
        }
        .word-option {
            display: inline-block;
            background: #FFA726;
            color: white;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }
        .word-option:hover {
            background: #FF8F00;
            transform: scale(1.05);
        }
        .word-option.used {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
        }
        .word-option.selected {
             background: #FF8F00;
             box-shadow: 0 0 0 3px #FFA726;
        }


        /* Collocations Matching */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        .matching-column {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #8BC34A;
        }
        .matching-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .matching-item:hover {
            background: #E8F5E8;
            border-color: #8BC34A;
        }
        .matching-item.selected {
            background: #8BC34A;
            color: white;
        }
        .matching-item.matched {
            background: #C8E6C9;
            border-color: #66BB6A;
            cursor: default;
        }
        
        .did-you-know {
            background: linear-gradient(135deg, #E0F7FA, #80DEEA);
            border-left: 5px solid #00ACC1;
            color: #006064;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }
        .did-you-know h3 {
            color: #004D40;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .did-you-know ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .did-you-know li {
            margin-bottom: 10px;
            position: relative;
        }
        .did-you-know li::before {
            content: 'üí°';
            position: absolute;
            left: -20px;
            font-size: 1.2em;
        }
        
        /* Sentence Scramble Styles */
        .scramble-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .scramble-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background: #F48FB1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .scramble-word {
            background: #FFE0B2;
            color: #5D4037;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            font-weight: bold;
        }
        .scramble-word:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .scramble-drop-area {
            min-height: 50px;
            border: 2px dashed #F48FB1;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .scramble-word.in-area {
            background: #FFD1E3;
            border: 1px solid #F48FB1;
            cursor: move;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .section { margin-bottom: 20px; padding: 20px; }
            .game-stats { flex-direction: column; gap: 15px; }
            .true-false-container { flex-direction: column; align-items: center; }
            .achievement { 
                position: static; 
                margin: 20px auto; 
                min-width: auto; 
                width: 90%; 
            }
            .matching-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body onload="shuffleCollocations(); setupScramble(); displayVocabQuestion(); setupAdvancedGrammar();">
    <div class="container">
        <div class="header">
            <h1>üç¨ Sweet Strategy: Haribo Business Mastery</h1>
            <p class="subtitle">Professional English Based on Real Business Success</p>
            
            <div class="game-stats">
                <div class="stat-item">
                    <span class="stat-number" id="score">0</span>
                    <span class="stat-label">POINTS</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="level">1</span>
                    <span class="stat-label">LEVEL</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="streak">0</span>
                    <span class="stat-label">STREAK</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="achievements">0</span>
                    <span class="stat-label">üèÜ BADGES</span>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
        </div>

        <div class="lesson-content">
            <div class="section warmup">
                <h2 class="section-title">
                    <span class="emoji">‚ö°</span>Speed Challenge: Business Basics
                    <span class="level-badge">LEVEL 1</span>
                </h2>
                
                <div class="timer" id="speedTimer" style="display:none;">
                    <span>‚è∞</span>
                    <span id="timeLeft">30</span> seconds
                </div>
                
                <div class="quiz-container" id="speedQuiz" style="display:none;">
                    <div class="question-counter">Speed Round 1/5</div>
                    <div class="quiz-question"></div>
                    <div class="quiz-options"></div>
                </div>

                <button class="btn" onclick="startSpeedRound()">üèÉ‚Äç‚ôÇÔ∏è Start 30-Second Challenge</button>
            </div>

            <hr>

            <div class="did-you-know">
                <h3>üí° Did you know?</h3>
                <ul>
                    <li>The name **Haribo** is an acronym formed from the first two letters of its founder's name and its city of origin: **HA**ns **RI**egel, **BO**nn.</li>
                    <li>The first Haribo product was not the Goldbear! It was the "Dancing Bear," a larger, thinner gummy that was later redesigned into the iconic Goldbear we know today.</li>
                    <li>In Germany, the Goldbear product is called "Gummib√§rchen," a beloved national icon. The German slogan is "Haribo macht Kinder froh ‚Äì und Erwachsene ebenso," which translates to "Haribo makes children happy ‚Äì and adults too."</li>
                </ul>
            </div>

            <hr>

            <div class="section listening">
                <h2 class="section-title">
                    <span class="emoji">üìä</span>Reading Comprehension: Haribo's Numbers
                    <span class="level-badge">LEVEL 2</span>
                </h2>

                <div class="story-box">
                    <p><strong>üìà Haribo's Impressive Statistics</strong></p>
                    <p>Haribo's Wisconsin factory is a <span class="highlight">manufacturing powerhouse</span> that produces <strong>60 million</strong> Goldbears every single day. This massive <strong>500,000 square foot</strong> facility opened in <strong>2023</strong> and can produce approximately <strong>25 different types</strong> of gummy products.</p>
                    
                    <p>The impact on <span class="highlight">supply chain efficiency</span> has been dramatic. Previously, getting Haribo products from European factories to US consumers took <strong>12 to 14 weeks</strong> because products had to travel through Rotterdam and make a long ocean journey. Now, with local production, delivery time is measured in weeks, not months.</p>
                    
                    <p>This efficiency supports Haribo's global network of <strong>16 factories worldwide</strong>. The strategy is working - the company added <strong>2.6 million new American households</strong> to their customer base in just one year, while sugar candy sales overall have increased by <strong>74 percent since 2020</strong>.</p>
                </div>

                <div class="quiz-container">
                    <div class="question-counter">Numbers Challenge</div>
                    <div class="quiz-question">Complete the sentences with the correct numbers from the text:</div>
                    
                    <p style="margin: 15px 0;">1. The Wisconsin factory produces <input type="number" class="number-input" id="num1" data-answer="60"> million Goldbears daily.</p>
                    
                    <p style="margin: 15px 0;">2. The factory covers <input type="number" class="number-input" id="num2" data-answer="500000"> square feet.</p>
                    
                    <p style="margin: 15px 0;">3. Previously, shipping took <input type="number" class="number-input" id="num3" data-answer="12"> to <input type="number" class="number-input" id="num4" data-answer="14"> weeks.</p>
                    
                    <p style="margin: 15px 0;">4. Haribo operates <input type="number" class="number-input" id="num5" data-answer="16"> factories globally.</p>
                    
                    <p style="margin: 15px 0;">5. Sugar candy sales increased <input type="number" class="number-input" id="num6" data-answer="74"> percent since 2020.</p>
                </div>

                <button class="btn" onclick="checkNumbers()">üìä Check My Numbers</button>
            </div>

            <hr>

            <div class="section quiz">
                <h2 class="section-title">
                    <span class="emoji">‚úÖ</span>True or False?
                    <span class="level-badge">LEVEL 3</span>
                </h2>
                <div class="quiz-container">
                    <div class="quiz-question">The US factory helped reduce shipping time to American consumers.</div>
                    <div class="true-false-container">
                        <button class="tf-button true" onclick="answerTrueFalse(this, true, true)">TRUE</button>
                        <button class="tf-button false" onclick="answerTrueFalse(this, true, false)">FALSE</button>
                    </div>
                </div>
                 <div class="quiz-container">
                    <div class="quiz-question">Haribo's first product was the Goldbear.</div>
                    <div class="true-false-container">
                        <button class="tf-button true" onclick="answerTrueFalse(this, false, true)">TRUE</button>
                        <button class="tf-button false" onclick="answerTrueFalse(this, false, false)">FALSE</button>
                    </div>
                </div>
            </div>

            <hr>

            <div class="section grammar">
                <h2 class="section-title">
                    <span class="emoji">üìù</span>Grammar Challenge: Sentence Scramble
                    <span class="level-badge">NEW!</span>
                </h2>
                <p><strong>Instructions:</strong> Drag and drop the words to form a grammatically correct sentence.</p>
                <div class="scramble-container" id="scrambleContainer">
                    </div>
                <button class="btn" onclick="checkScramble()">‚úÖ Check Sentences</button>
            </div>

            <hr>

            <div class="section reported-speech">
                <h2 class="section-title">
                    <span class="emoji">üíº</span>Advanced Grammar: Business Scenarios
                    <span class="level-badge">NEW!</span>
                </h2>
                <div class="quiz-container" id="advancedGrammarQuiz">
                    </div>
                <button class="btn" onclick="checkAdvancedGrammar()">‚úÖ Check My Answers</button>
            </div>
            
            <hr>

            <div class="section gapfill">
                <h2 class="section-title">
                    <span class="emoji">üìù</span>Gap Fill: Haribo's Strategy
                    <span class="level-badge">LEVEL 5</span>
                </h2>
                
                <div class="word-bank">
                    <strong>Word Bank:</strong>
                    <span class="word-option" onclick="selectWord(this)" data-word="focus">focus</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="economies">economies</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="diversified">diversified</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="volume">volume</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="leverage">leverage</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="efficiently">efficiently</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="local">local</span>
                    <span class="word-option" onclick="selectWord(this)" data-word="agile">agile</span>
                </div>

                <div class="gap-fill-text">
                    <p>Haribo's success comes from their strategy of <input type="text" class="gap-input" id="gap1" data-answer="focus" readonly onclick="fillGap(this)">. While other companies have <input type="text" class="gap-input" id="gap2" data-answer="diversified" readonly onclick="fillGap(this)"> businesses, Haribo concentrates on gummy candy.</p>
                    
                    <p>This approach gives them <input type="text" class="gap-input" id="gap3" data-answer="economies" readonly onclick="fillGap(this)"> of scale because they can buy ingredients in larger <input type="text" class="gap-input" id="gap4" data-answer="volume" readonly onclick="fillGap(this)"> and get <input type="text" class="gap-input" id="gap5" data-answer="leverage" readonly onclick="fillGap(this)"> with suppliers.</p>
                    
                    <p>However, this strategy only works when you're <input type="text" class="gap-input" id="gap6" data-answer="efficiently" readonly onclick="fillGap(this)"> making something people want. Having <input type="text" class="gap-input" id="gap7" data-answer="local" readonly onclick="fillGap(this)"> facilities helps companies be more <input type="text" class="gap-input" id="gap8" data-answer="agile" readonly onclick="fillGap(this)"> and responsive.</p>
                </div>

                <button class="btn" onclick="checkGapFill()">‚úÖ Check Gap Fill</button>
            </div>
            
            <hr>

            <div class="section new-vocab">
                <h2 class="section-title">
                    <span class="emoji">üí¨</span>Contextual Vocabulary Quiz
                    <span class="level-badge">NEW!</span>
                </h2>
                <div class="quiz-container" id="vocabQuiz">
                    <div class="question-counter">Question 1/3</div>
                    <div class="quiz-question"></div>
                    <div class="quiz-options">
                        </div>
                </div>
            </div>
            
            <hr>

            <div class="section vocab">
                <h2 class="section-title">
                    <span class="emoji">üîó</span>Business Collocations Matching
                    <span class="level-badge">LEVEL 6</span>
                </h2>
                
                <p><strong>Instructions:</strong> Match business verbs with their common noun partners. Click one from each column!</p>
                
                <div class="matching-container">
                    <div class="matching-column" id="verbsColumn">
                        <h3 style="text-align: center; margin-bottom: 15px;">VERBS</h3>
                    </div>
                    <div class="matching-column" id="nounsColumn">
                        <h3 style="text-align: center; margin-bottom: 15px;">NOUNS</h3>
                    </div>
                </div>

                <button class="btn" onclick="checkMatching()">üîó Check Matches</button>
            </div>
        </div>
    </div>

    <script>
        let score = 0;
        let level = 1;
        let streak = 0;
        let achievements = 0;
        const totalSections = 8;
        let totalQuestionsAnswered = 0;
        let correctAnswersCount = 0;

        function updateStats(points, resetStreak = false) {
            score += points;
            if (resetStreak) {
                streak = 0;
            } else {
                streak++;
            }
            if (score >= 100 * level) {
                level++;
                score = 0;
                showAchievement(`Level Up! You are now Level ${level}! üéâ`);
            }
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('streak').textContent = streak;
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = (score / (100 * level)) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function showAchievement(message) {
            const achievementBox = document.createElement('div');
            achievementBox.className = 'achievement';
            achievementBox.textContent = message;
            document.body.appendChild(achievementBox);
            achievements++;
            document.getElementById('achievements').textContent = achievements;
            setTimeout(() => {
                achievementBox.remove();
            }, 3000);
        }

        function showFeedback(element, isCorrect, message) {
            const feedbackBox = document.createElement('div');
            feedbackBox.className = `feedback-box ${isCorrect ? 'excellent' : 'needs-improvement'}`;
            feedbackBox.innerHTML = `${isCorrect ? 'ü•≥ Excellent!' : 'üòü Try again!'} ${message}`;
            element.parentNode.insertBefore(feedbackBox, element.nextSibling);
            setTimeout(() => {
                feedbackBox.remove();
            }, 5000);
        }

        // Helper function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Speed Challenge
        let speedQuizIndex = 0;
        const speedQuestions = [
            { q: 'What gives companies "economies of scale"?', a: 'Large-scale production', options: ['Small production batches', 'Large-scale production', 'Multiple product lines', 'High employee turnover'] },
            { q: 'What is a "supply chain"?', a: 'A network of suppliers and producers', options: ['A single factory', 'A network of suppliers and producers', 'A type of inventory', 'A delivery truck'] },
            { q: 'What is "market share"?', a: 'The percentage of total sales a company has', options: ['A new stock market listing', 'The percentage of total sales a company has', 'A shared office space', 'A marketing campaign'] },
            { q: 'What does "B2B" stand for?', a: 'Business to Business', options: ['Brand to Business', 'Business to Business', 'Back to Basics', 'Budget to Budget'] },
            { q: 'What is "brand loyalty"?', a: 'Customers repeatedly buying from the same brand', options: ['A new logo design', 'Customers repeatedly buying from the same brand', 'A legal agreement', 'A discount program'] }
        ];
        let speedTimer;
        let timeLeft = 30;
        let speedQuizCorrect = 0;

        function startSpeedRound() {
            speedQuizIndex = 0;
            speedQuizCorrect = 0;
            timeLeft = 30;
            document.getElementById('speedTimer').style.display = 'inline-flex';
            document.querySelector('.warmup button').style.display = 'none';
            document.getElementById('speedQuiz').style.display = 'block';
            nextSpeedQuestion();
            speedTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(speedTimer);
                    endSpeedRound();
                }
            }, 1000);
        }
        
        function nextSpeedQuestion() {
            if (speedQuizIndex >= speedQuestions.length) {
                endSpeedRound();
                return;
            }
            const q = speedQuestions[speedQuizIndex];
            const quizContainer = document.getElementById('speedQuiz');
            quizContainer.querySelector('.question-counter').textContent = `Speed Round ${speedQuizIndex + 1}/5`;
            quizContainer.querySelector('.quiz-question').textContent = q.q;

            const optionsContainer = quizContainer.querySelector('.quiz-options');
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = shuffleArray([...q.options]);

            shuffledOptions.forEach(optionText => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = optionText;
                
                const isCorrect = optionText === q.a;
                optionElement.onclick = () => answerSpeed(optionElement, isCorrect);
                
                optionsContainer.appendChild(optionElement);
            });
        }


        function answerSpeed(element, isCorrect) {
            const allOptions = element.parentNode.children;
            for (let i = 0; i < allOptions.length; i++) {
                allOptions[i].style.pointerEvents = 'none';
                if (allOptions[i].textContent === speedQuestions[speedQuizIndex].a) {
                    allOptions[i].classList.add('correct');
                } else if (element === allOptions[i]) {
                    element.classList.add('incorrect');
                }
            }
            if (isCorrect) {
                speedQuizCorrect++;
            }
            setTimeout(() => {
                speedQuizIndex++;
                if (speedQuizIndex < speedQuestions.length) {
                    nextSpeedQuestion();
                } else {
                    endSpeedRound();
                }
            }, 1000);
        }

        function endSpeedRound() {
            clearInterval(speedTimer);
            document.getElementById('speedTimer').style.display = 'none';
            document.querySelector('.warmup button').style.display = 'block';
            let message = `You got ${speedQuizCorrect} out of 5 correct!`;
            if (speedQuizCorrect === 5) {
                showAchievement('Speed Demon! 5/5 correct! üèÜ');
                updateStats(50);
            } else {
                updateStats(speedQuizCorrect * 10, true);
            }
            showFeedback(document.querySelector('.warmup'), speedQuizCorrect === 5, message);
        }


        // Numbers Challenge
        function checkNumbers() {
            const inputs = document.querySelectorAll('#num1, #num2, #num3, #num4, #num5, #num6');
            let correctCount = 0;
            inputs.forEach(input => {
                const isCorrect = input.value == input.getAttribute('data-answer');
                if (isCorrect) {
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                    correctCount++;
                } else {
                    input.classList.remove('correct');
                    input.classList.add('incorrect');
                }
            });

            if (correctCount === inputs.length) {
                updateStats(50);
                showAchievement('Numbers Guru! All numbers correct! üî¢');
                showFeedback(document.querySelector('.listening'), true, 'You got all the numbers right!');
            } else {
                updateStats(0, true);
                showFeedback(document.querySelector('.listening'), false, `You got ${correctCount} out of ${inputs.length} correct. The correct answers are: 60, 500000, 12, 14, 16, 74.`);
            }
        }

        // True/False
        function answerTrueFalse(button, correctAnswer, userChoice) {
            const container = button.closest('.quiz-container');
            const allButtons = container.querySelectorAll('.tf-button');
            allButtons.forEach(btn => btn.style.pointerEvents = 'none'); // Disable buttons
            
            if (userChoice === correctAnswer) {
                button.classList.add('selected', 'true');
                updateStats(25);
                showFeedback(container, true, 'Great job! That is correct!');
            } else {
                button.classList.add('selected', 'false');
                updateStats(0, true);
                const correctButton = container.querySelector(correctAnswer ? '.tf-button.true' : '.tf-button.false');
                correctButton.classList.add('selected', 'true');
                showFeedback(container, false, 'That is incorrect. The correct answer is ' + (correctAnswer ? 'True' : 'False') + '.');
            }
        }
        
        // New Grammar Activity: Sentence Scramble
        const scrambleSentences = [
            ['Haribo', 'must', 'continue', 'to', 'innovate', 'its', 'product', 'line.'],
            ['The', 'company', 'can', 'leverage', 'its', 'brand', 'recognition', 'to', 'enter', 'new', 'markets.'],
            ['A', 'strong', 'brand', 'identity', 'is', 'essential', 'for', 'long-term', 'growth.']
        ];
        let currentScrambleIndex = 0;
        let dragSource = null;

        function setupScramble() {
            const container = document.getElementById('scrambleContainer');
            container.innerHTML = '';
            
            scrambleSentences.forEach((sentence, index) => {
                const quizBox = document.createElement('div');
                quizBox.className = 'quiz-container';
                quizBox.innerHTML = `
                    <p><strong>Sentence ${index + 1}:</strong></p>
                    <div class="scramble-words" data-correct="${sentence.join(' ')}"></div>
                    <div class="scramble-drop-area"></div>
                `;
                container.appendChild(quizBox);

                const wordsContainer = quizBox.querySelector('.scramble-words');
                const words = [...sentence].sort(() => Math.random() - 0.5);
                words.forEach(word => {
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'scramble-word';
                    wordSpan.textContent = word;
                    wordSpan.draggable = true;
                    wordSpan.addEventListener('dragstart', handleDragStart);
                    wordsContainer.appendChild(wordSpan);
                });

                const dropArea = quizBox.querySelector('.scramble-drop-area');
                dropArea.addEventListener('dragover', handleDragOver);
                dropArea.addEventListener('drop', handleDrop);
            });
        }
        
        function handleDragStart(e) {
            dragSource = e.target;
            e.dataTransfer.effectAllowed = 'move';
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropArea = e.target.closest('.scramble-drop-area');
            if (dropArea) {
                dropArea.appendChild(dragSource);
                dragSource.classList.add('in-area');
            }
        }

        function checkScramble() {
            let allCorrect = true;
            document.querySelectorAll('.scramble-container .quiz-container').forEach(quizBox => {
                const dropArea = quizBox.querySelector('.scramble-drop-area');
                const correctSentence = quizBox.querySelector('.scramble-words').dataset.correct;
                const userSentence = Array.from(dropArea.children).map(child => child.textContent).join(' ');
                
                if (userSentence === correctSentence) {
                    showFeedback(quizBox, true, 'Correct sentence!');
                } else {
                    allCorrect = false;
                    showFeedback(quizBox, false, `The correct sentence is: "${correctSentence}"`);
                }
            });
            if (allCorrect) {
                updateStats(75);
                showAchievement('Grammar Wizard! All sentences correct! üìñ');
            } else {
                updateStats(0, true);
            }
        }

        // New Advanced Grammar Section
        const advancedGrammarQuestions = [
            {
                type: 'reported-speech',
                q: 'The CEO said, "We will expand our market share next year."',
                a: 'The CEO said that they would expand their market share the following year.',
                options: [
                    'The CEO said that they will expand their market share next year.',
                    'The CEO said that they would expand their market share the following year.',
                    'The CEO said that we would expand our market share the next year.',
                    'The CEO said that they have expanded their market share the following year.'
                ]
            },
            {
                type: 'conditional',
                q: 'The deal will be successful if we manage to cut costs.',
                a: 'If we manage to cut costs, the deal will be successful.',
                options: [
                    'If we manage to cut costs, the deal will be successful.',
                    'If we had managed to cut costs, the deal would be successful.',
                    'If we cut costs, the deal would have been successful.',
                    'The deal would be successful if we had managed to cut costs.'
                ]
            },
            {
                type: 'reported-speech',
                q: 'The manager asked, "Have you submitted the report yet?"',
                a: 'The manager asked if I had submitted the report yet.',
                options: [
                    'The manager asked if I have submitted the report yet.',
                    'The manager asked whether I submitted the report yet.',
                    'The manager asked if I had submitted the report yet.',
                    'The manager asked me did I submit the report yet.'
                ]
            }
        ];
        let advancedGrammarQuizIndex = 0;

        function setupAdvancedGrammar() {
            const container = document.getElementById('advancedGrammarQuiz');
            container.innerHTML = '';
            
            advancedGrammarQuestions.forEach((q, index) => {
                const quizBox = document.createElement('div');
                quizBox.className = 'quiz-container';
                quizBox.innerHTML = `
                    <div class="question-counter">Question ${index + 1}/${advancedGrammarQuestions.length}</div>
                    <div class="quiz-question"><strong>Original sentence:</strong> "${q.q}"<br>Choose the correct rephrased sentence:</div>
                    <div class="quiz-options">
                        ${q.options.map((option, i) => `
                            <div class="quiz-option" data-correct="${option === q.a}">${option}</div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(quizBox);
            });
            
            document.querySelectorAll('#advancedGrammarQuiz .quiz-options').forEach(optionsContainer => {
                optionsContainer.addEventListener('click', (e) => {
                    const clickedOption = e.target.closest('.quiz-option');
                    if (!clickedOption) return;
                    const isCorrect = clickedOption.getAttribute('data-correct') === 'true';
                    checkAdvancedGrammarOption(clickedOption, isCorrect);
                });
            });
        }
        
        function checkAdvancedGrammarOption(element, isCorrect) {
            const quizContainer = element.closest('.quiz-container');
            const allOptions = quizContainer.querySelectorAll('.quiz-option');
            
            allOptions.forEach(opt => opt.style.pointerEvents = 'none');

            if (isCorrect) {
                element.classList.add('correct');
                updateStats(30);
                showFeedback(quizContainer, true, 'Correct! Excellent use of grammar.');
            } else {
                element.classList.add('incorrect');
                updateStats(0, true);
                const correctElement = quizContainer.querySelector('.quiz-option[data-correct="true"]');
                if (correctElement) {
                    correctElement.classList.add('correct');
                }
                showFeedback(quizContainer, false, 'Incorrect. Review the rules for reported speech and conditionals.');
            }
        }
        
        function checkAdvancedGrammar() {
            let allCorrect = true;
            document.querySelectorAll('#advancedGrammarQuiz .quiz-container').forEach(quizBox => {
                const selectedCorrect = quizBox.querySelector('.quiz-option.correct');
                if (!selectedCorrect) {
                    allCorrect = false;
                }
            });
            
            if (allCorrect) {
                 showAchievement('Grammar Pro! All scenarios correct! üèÜ');
                 updateStats(100);
            } else {
                showFeedback(document.querySelector('.reported-speech'), false, 'Please complete all questions before checking your final score!');
            }
        }


        // Gap Fill
        let selectedWord = null;
        function selectWord(element) {
            // Remove 'selected' class from all words
            document.querySelectorAll('.word-option').forEach(opt => opt.classList.remove('selected'));
            
            // If the clicked word is not used, select it.
            if (!element.classList.contains('used')) {
                element.classList.add('selected');
                selectedWord = element;
            } else {
                // If the clicked word is already used, deselect it.
                selectedWord = null;
            }
        }

        function fillGap(input) {
            // If the input field already has a value, clear it and return the word to the bank
            if (input.value) {
                const wordInGap = input.value;
                const wordOption = document.querySelector(`.word-option[data-word="${wordInGap}"]`);
                if (wordOption) {
                    wordOption.classList.remove('used');
                }
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            }
            
            // If a word is currently selected in the word bank, place it in the gap
            if (selectedWord) {
                const wordToFill = selectedWord.dataset.word;
                input.value = wordToFill;
                selectedWord.classList.add('used');
                selectedWord.classList.remove('selected');
                selectedWord = null;
            }
        }

        function checkGapFill() {
            const inputs = document.querySelectorAll('.gap-input');
            let correctCount = 0;
            inputs.forEach(input => {
                const isCorrect = input.value === input.getAttribute('data-answer');
                if (isCorrect) {
                    input.classList.add('correct');
                    correctCount++;
                } else {
                    input.classList.add('incorrect');
                }
            });

            if (correctCount === inputs.length) {
                updateStats(100);
                showAchievement('Fill-in Master! Perfect score! ‚úçÔ∏è');
                showFeedback(document.querySelector('.gapfill'), true, 'All gaps filled correctly!');
            } else {
                updateStats(0, true);
                showFeedback(document.querySelector('.gapfill'), false, `You got ${correctCount} out of ${inputs.length} correct. The correct words are: focus, diversified, economies, volume, leverage, efficiently, local, agile.`);
            }
        }
        
        // New Vocabulary Activity: Contextual Vocabulary
        const vocabQuestions = [
            { q: 'To compete globally, a company must **___** its production methods.', a: 'optimize', options: ['downsize', 'optimize', 'abandon', 'complicate'] },
            { q: 'Increasing the number of stores is a strategy to grow your **___** footprint.', a: 'market', options: ['product', 'brand', 'market', 'financial'] },
            { q: 'The unexpected economic downturn had a negative **___** on our sales.', a: 'impact', options: ['trend', 'forecast', 'margin', 'impact'] }
        ];
        let vocabQuizIndex = 0;

        function displayVocabQuestion() {
            const container = document.getElementById('vocabQuiz');
            const optionsContainer = container.querySelector('.quiz-options');
            
            if (vocabQuizIndex >= vocabQuestions.length) {
                showFeedback(container, true, 'You have completed the vocabulary quiz!');
                return;
            }

            const q = vocabQuestions[vocabQuizIndex];
            container.querySelector('.question-counter').textContent = `Question ${vocabQuizIndex + 1}/${vocabQuestions.length}`;
            container.querySelector('.quiz-question').innerHTML = q.q;

            optionsContainer.innerHTML = ''; // Clear previous options
            
            const shuffledOptions = shuffleArray([...q.options]);

            shuffledOptions.forEach(optionText => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = optionText;
                
                const isCorrect = optionText === q.a;
                optionElement.onclick = () => checkVocabAnswer(optionElement, isCorrect);
                
                optionsContainer.appendChild(optionElement);
            });
        }

        function checkVocabAnswer(element, isCorrect) {
            const container = element.closest('.quiz-container');
            const allOptions = container.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => opt.style.pointerEvents = 'none');

            if (isCorrect) {
                element.classList.add('correct');
                updateStats(25);
                showFeedback(container, true, 'That is the correct word!');
            } else {
                element.classList.add('incorrect');
                updateStats(0, true);
                const correctElement = Array.from(allOptions).find(opt => opt.textContent === vocabQuestions[vocabQuizIndex].a);
                if (correctElement) {
                    correctElement.classList.add('correct');
                }
                showFeedback(container, false, `Incorrect. The correct answer is "${vocabQuestions[vocabQuizIndex].a}".`);
            }
            
            setTimeout(() => {
                vocabQuizIndex++;
                displayVocabQuestion();
            }, 1500);
        }

        // Collocations Matching
        const collocations = [
            {verb: 'EXPAND', noun: 'markets'},
            {verb: 'ACHIEVE', noun: 'advantage'},
            {verb: 'DEVELOP', noun: 'products'},
            {verb: 'CONDUCT', noun: 'research'},
            {verb: 'REDUCE', noun: 'costs'}
        ];
        
        let selectedVerb = null;
        let selectedNoun = null;
        let matchedPairs = 0;
        let allItems = new Map();

        function shuffleCollocations() {
            const verbs = collocations.map(c => c.verb);
            const nouns = collocations.map(c => c.noun);
            
            for (let i = nouns.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [nouns[i], nouns[j]] = [nouns[j], nouns[i]];
            }
            
            const verbsColumn = document.getElementById('verbsColumn');
            verbsColumn.innerHTML = '<h3 style="text-align: center; margin-bottom: 15px;">VERBS</h3>';
            verbs.forEach(verb => {
                const verbItem = document.createElement('div');
                verbItem.className = 'matching-item';
                verbItem.textContent = verb;
                verbItem.dataset.match = collocations.find(c => c.verb === verb).noun;
                verbItem.addEventListener('click', () => selectMatching('verb', verbItem));
                verbsColumn.appendChild(verbItem);
                allItems.set(verb, verbItem);
            });
            
            const nounsColumn = document.getElementById('nounsColumn');
            nounsColumn.innerHTML = '<h3 style="text-align: center; margin-bottom: 15px;">NOUNS</h3>';
            nouns.forEach(noun => {
                const nounItem = document.createElement('div');
                nounItem.className = 'matching-item';
                nounItem.textContent = noun;
                nounItem.dataset.match = collocations.find(c => c.noun === noun).verb;
                nounItem.addEventListener('click', () => selectMatching('noun', nounItem));
                nounsColumn.appendChild(nounItem);
                allItems.set(noun, nounItem);
            });
            
            matchedPairs = 0;
        }

        function selectMatching(type, element) {
            if (element.classList.contains('matched')) return;

            if (type === 'verb') {
                if (selectedVerb) {
                    selectedVerb.classList.remove('selected');
                }
                selectedVerb = element;
            } else {
                if (selectedNoun) {
                    selectedNoun.classList.remove('selected');
                }
                selectedNoun = element;
            }

            element.classList.add('selected');
        }

        function checkMatching() {
            if (selectedVerb && selectedNoun) {
                const verbMatch = selectedVerb.dataset.match;
                const nounMatch = selectedNoun.textContent;

                if (verbMatch === nounMatch) {
                    selectedVerb.classList.add('matched');
                    selectedNoun.classList.add('matched');
                    matchedPairs++;
                    updateStats(30);
                    showFeedback(document.querySelector('.matching-container'), true, 'Correct match! Keep going!');
                } else {
                    updateStats(0, true);
                    showFeedback(document.querySelector('.matching-container'), false, 'Incorrect match. Try another pair!');
                }

                selectedVerb.classList.remove('selected');
                selectedNoun.classList.remove('selected');
                selectedVerb = null;
                selectedNoun = null;

                if (matchedPairs === collocations.length) {
                    showAchievement('Collocation Champion! All pairs matched! üèÜ');
                    updateStats(100);
                }
            }
        }

        window.onload = function() {
            shuffleCollocations();
            setupScramble();
            displayVocabQuestion();
            setupAdvancedGrammar();
        };
    </script>
</body>
</html>